<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Usage Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Reset & layout */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { display: flex; height: 100vh; overflow: hidden; font-family: 'Inter', sans-serif; background: #f4f6f8; }
    .sidebar { width: 220px; background: #1a1a2e; color: #fff; display: flex; flex-direction: column; padding: 30px 20px; }
    .sidebar .logo { font-size: 24px; font-weight: 700; text-align: center; margin-bottom: 40px; }
    .sidebar nav a { display: block; text-decoration: none; color: #fff; padding: 10px; margin-bottom: 20px; border-radius: 8px; transition: background 0.3s; font-weight: 500; }
    .sidebar nav a:hover { background: #16213e; }
    .sidebar-footer { margin-top: auto; display: flex; justify-content: space-around; }
    .sidebar-footer button { background: transparent; border: none; color: #fff; font-size: 18px; cursor: pointer; }

    .main-content { flex: 1; padding: 20px; overflow-y: auto; }
    .main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .main-header h1 { font-size: 24px; color: #333; }
    .main-header .search { padding: 8px 12px; border: 1px solid #ccc; border-radius: 8px; width: 200px; }

    .dashboard { display: flex; flex-direction: column; gap: 40px; }
    .row { display: flex; gap: 40px; }

    .summary-section { gap: 20px; }
    .summary-card { flex: 1; background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); position: relative; }
    .summary-card h3 { font-size: 18px; color: #333; margin-bottom: 8px; }
    .summary-card .card-subtitle { font-size: 14px; color: #666; margin-bottom: 12px; }
    .summary-card ul { list-style: none; }
    .summary-card li { margin-bottom: 8px; padding: 8px 12px; border-radius: 8px; background: #f2f2f2; font-size: 14px; }
    .summary-card table { width: 100%; border-collapse: collapse; font-size: 14px; }
    .summary-card th, .summary-card td { text-align: left; padding: 8px; }
    .summary-card th { border-bottom: 2px solid #eee; }

    .card { flex: 1; background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .header h2 { font-size: 18px; color: #333; font-weight: 600; }
    .toggle-buttons { background: #f0f0f0; border-radius: 999px; display: flex; padding: 5px; }
    .toggle { background: transparent; border: none; padding: 8px 16px; border-radius: 999px; cursor: pointer; color: #7d7d7d; font-weight: 600; transition: all 0.3s; }
    .toggle.active { background: #1a1a2e; color: #fff; }
    canvas { width: 100% !important; height: auto !important; margin-top: 10px; }

    /* Icons in summary cards */
    .card-icon { position: absolute; top: 20px; left: 20px; font-size: 20px; }
    .warning { color: #f5a623; }
    .info    { color: #4a90e2; }
    .error   { color: #d0021b; }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="logo">INTERDATA</div>
    <nav>
      <a href="#">Host Machine</a>
      <a href="#">Container</a>
    </nav>
    <div class="sidebar-footer">
      <button title="Notifications">üîî</button>
      <button title="Home">üè†</button>
      <button title="Profile">üë§</button>
    </div>
  </div>

  <div class="main-content">
    <header class="main-header">
      <h1>Dashboard</h1>
      <input type="search" class="search" placeholder="Search..." />
    </header>

    <div class="dashboard">
      <div class="row summary-section">
        <div class="summary-card">
          <h3>Network Speed Surge</h3>
          <p class="card-subtitle">Host</p>
          <ul id="topSpeedHosts"></ul>
        </div>
        <div class="summary-card">
          <h3>Network Speed Surge</h3>
          <p class="card-subtitle">Container</p>
          <ul id="topSpeedContainers"></ul>
        </div>
        <div class="summary-card">
          <h3>Recent Under-resourced</h3>
          <table id="underResourcedTable">
            <thead><tr><th>Name</th><th>CPU</th><th>Memory</th><th>Disk</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="row">
        <div class="card">
          <div class="header">
            <h2>Host Machine Usage</h2>
            <div class="toggle-buttons host">
              <button class="toggle active" data-type="cpu" data-target="host">CPU</button>
              <button class="toggle" data-type="memory" data-target="host">Memory</button>
              <button class="toggle" data-type="disk" data-target="host">Disk</button>
            </div>
          </div>
          <canvas id="hostChart"></canvas>
        </div>
        <div class="card">
          <div class="header">
            <h2>Container Usage</h2>
            <div class="toggle-buttons container">
              <button class="toggle active" data-type="cpu" data-target="container">CPU</button>
              <button class="toggle" data-type="memory" data-target="container">Memory</button>
              <button class="toggle" data-type="disk" data-target="container">Disk</button>
            </div>
          </div>
          <canvas id="containerChart"></canvas>
        </div>
      </div>

      <div class="row">
        <div class="card">
          <div class="header"><h2>Network Traffic</h2></div>
          <canvas id="networkChart"></canvas>
        </div>
        <div class="card">
          <div class="header"><h2>Network Speed</h2></div>
          <canvas id="networkSpeedChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    let hostChart, containerChart;
    document.addEventListener('DOMContentLoaded', () => {
      fetch('host.json')
        .then(res => res.json())
        .then(hosts => {
          fetch('container.json')
            .then(res => res.json())
            .then(containers => {
              // Usage charts
              initializeChart('hostChart', hosts, 'cpu', 'host');
              setupToggleButtons(hosts, 'host');
              initializeChart('containerChart', containers, 'cpu', 'container');
              setupToggleButtons(containers, 'container');

              // Summary
              renderSummary(hosts, containers);

              // Network charts from host.json only
              initializeNetworkChart(hosts);
              initializeNetworkSpeedChart(hosts);
            });
        });
    });

    function renderSummary(hostData, containerData) {
      const hostSpeeds = hostData
        .map(h => ({ name: h.hostName, speed: (parseInt(h.network.eth0_0.speedbps) + parseInt(h.network.wlan0_1.speedbps)) / 1e6 }))
        .sort((a,b) => b.speed - a.speed)
        .slice(0,3);
      const hostList = document.getElementById('topSpeedHosts');
      hostSpeeds.forEach(h => {
        const li = document.createElement('li');
        li.textContent = `${h.name} - ${h.speed.toFixed(0)} Mbps`;
        hostList.appendChild(li);
      });

      const contSpeeds = containerData
        .map(c => ({ name: c.containerName, speed: c.network.eth0.speedBps / 1e6 }))
        .sort((a,b) => b.speed - a.speed)
        .slice(0,3);
      const contList = document.getElementById('topSpeedContainers');
      contSpeeds.forEach(c => {
        const li = document.createElement('li');
        li.textContent = `${c.name} - ${c.speed.toFixed(0)} Mbps`;
        contList.appendChild(li);
      });

      const combined = [];
      hostData.forEach(h => combined.push({ name: h.hostName, cpu: h.cpuUsagePercent, memory: (h.memoryUsedBytes / h.memoryTotalBytes) * 100, disk: (h.diskUsedBytes / h.diskTotalBytes) * 100 }));
      containerData.forEach(c => combined.push({ name: c.containerName, cpu: c.cpuUsagePercent, memory: (c.memoryUsedBytes / c.memoryTotalBytes) * 100, disk: ((c.diskReadBytes + c.diskWriteBytes) / (c.diskReadBytes + c.diskWriteBytes + 1)) * 100 }));
      combined.sort((a,b) => b.cpu - a.cpu).slice(0,3).forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${item.name}</td><td>${item.cpu.toFixed(0)}%</td><td>${item.memory.toFixed(0)}%</td><td>${item.disk.toFixed(0)}%</td>`;
        document.querySelector('#underResourcedTable tbody').appendChild(tr);
      });
    }

    // Usage charts
    function initializeChart(canvasId, data, type, target) {
      const ctx = document.getElementById(canvasId).getContext('2d');
      const chartData = prepareChartData(data, type, target);
      const chart = new Chart(ctx, {
        type: 'bar', data: { labels: chartData.labels, datasets: [{ data: chartData.values, backgroundColor: '#6a5acd', borderRadius: 10, barThickness: 20 }] },
        options: { scales: { y: { beginAtZero: true, grid: { color: '#eee' } }, x: { grid: { color: '#eee' } } }, plugins: { legend: { display: false } } }
      });
      if (target === 'host') hostChart = chart; else containerChart = chart;
    }

    function setupToggleButtons(data, target) {
      document.querySelectorAll(`.toggle-buttons.${target} .toggle`).forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll(`.toggle-buttons.${target} .toggle`).forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          const type = btn.getAttribute('data-type');
          const chart = target === 'host' ? hostChart : containerChart;
          const cd = prepareChartData(target === 'host' ? hosts : containers, type, target);
          chart.data.labels = cd.labels; chart.data.datasets[0].data = cd.values; chart.update();
        });
      });
    }

    function prepareChartData(data, type, target) {
      const labels = target === 'host' ? data.map(h => h.hostName) : data.map(c => c.containerName);
      let values = [];
      if (type === 'cpu') values = data.map(x => x.cpuUsagePercent);
      else if (type === 'memory') values = data.map(x => ((x.memoryUsedBytes / x.memoryTotalBytes) * 100).toFixed(1));
      else if (type === 'disk') values = data.map(x => (((x.diskReadBytes + x.diskWriteBytes) / ((x.diskReadBytes + x.diskWriteBytes) + 1)) * 100).toFixed(1));
      return { labels, values };
    }

    // Network charts from host.json
    function initializeNetworkChart(hostData) {
      const labels = hostData.map(h => h.hostName);
      const received = hostData.map(h => parseInt(h.network.eth0_0.bytesReceived) + parseInt(h.network.wlan0_1.bytesReceived));
      const sent     = hostData.map(h => parseInt(h.network.eth0_0.bytesSent)     + parseInt(h.network.wlan0_1.bytesSent));
      const ctx = document.getElementById('networkChart').getContext('2d');
      new Chart(ctx, { type: 'line', data: { labels, datasets: [{ label: 'Bytes Received', data: received, fill: true, tension: 0.3 }, { label: 'Bytes Sent', data: sent, fill: true, tension: 0.3 }] }, options: { scales: { y: { beginAtZero: true, ticks: { callback: v => (v/1e6).toFixed(1) + ' MB' } } } } });
    }

    function initializeNetworkSpeedChart(hostData) {
      const labels = hostData.map(h => h.hostName);
      const ethSpeed  = hostData.map(h => parseInt(h.network.eth0_0.speedbps) / 1e6);
      const wlanSpeed = hostData.map(h => parseInt(h.network.wlan0_1.speedbps) / 1e6);
      const ctx = document.getElementById('networkSpeedChart').getContext('2d');
      new Chart(ctx, { type: 'line', data: { labels, datasets: [{ label: 'eth0 (Mbps)', data: ethSpeed, fill: false, tension: 0.3 }, { label: 'wlan0 (Mbps)', data: wlanSpeed, fill: false, tension: 0.3 }] }, options: { scales: { y: { beginAtZero: true, title: { display: true, text: 'Mbps' } } } } });
    }
  </script>
</body>
</html>